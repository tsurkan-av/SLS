Имеется sls-шлюз
 Version: 2022.12.31d2
ChipType: TI CC2652
Имеются Zigbee устройства:
Aqara датчик открытия двери MCCGQ11LM, Aqara датчик движения RTCGQ11LM, Aqara датчик протечки SJCGQ11LM, Aqara датчик температуры и влажности WSDCGQ11LM, Aqara лампочка ZNLDP12LM, Мотор для закрытия газового крана SM-AW713Z.
Все устройства определяются в Zigbee -> Devices, и функционируют.
Нужно создать и внедрить логику взаимодействия устройствами между др. другом и между пользователем через Телеграмм.

Задача 1.
Датчик открытия двери + датчик движения. Они определяют: 
а) После закрытия двери кто то вышел из комнаты?
	контролируем по ДД: 
	НАДО проверить - реагирует ли ДД на движение двери? Если реагирует, то ДД и СМК будут срабатывать в одно время
	НАДО Добиться чтобы ДД НЕ срабатывал на движение двери. Иначе он здесь будет не особо полезен
	
	скрипт на State СМК contact
	local contact = Event.State.Value
	Если contact -- == true - дверь закрыли
		Если occupancy == true -- и в этот момент ДД в сработке
		-- значит кто-то вышел из комнаты
		-- проверим - вышел ли? запустим скрипт, который проверит статус occupancy через время occupancy_timeout
		scripts.setTimer("checkOccupancy", os.time() + occupancy_timeout, "Param") -- в Param надо передать адрес датчика ДД и, как вариант, действие
		Иначе -- occupancy == false
		-- значит дверь открыли/закрыли снаружи - в комнату никто не заходил или ложняк СМК
	-- По ТЗ на открывание проверять не требуется
	--[[
	Иначе -- contact == false -- дверь открыли
		Если occupancy == true -- и в этот момент ДД в сработке
		-- значит двери открыли изнутри
		Иначе -- occupancy == false
		-- дверь открыли снаружи и по хорошему надо бы подождать сработки ДД
	--]]
	
	----------------------------
	--checkOccupancy.lua
	-- разбираю аргументы 
	-- Param = ieeeAddr|tlg
	
	local arr = explode("|", Event.Param)
	local ieeeAddr = arr[1] -- адрес ДД
	local tlg = arr[2] -- bool, отправлять или нет сообщение
	
	if zigbee.value(ieeeAddr, "occupancy") then
	-- если по истечении occupancy_timeout ДД в сработке, значит в комнате кто-то есть
	
	
	
	
b) После закрытия двери кто то зашел в комнату?
с) или же открыл, закрыл дверь, оставаясь внутри. (учитывая, что в доме живет один человек). 
Далее в телеграмм отправляется уведомление: 
- Открылась дверь в 12:05
- Закрылась дверь в 12:05
- (через 1 мин, если нет движения) Дома никого нет.



2) Если срабатывает Датчик протечки воды, Мотор для закрытия газового крана перекрывает 2 крана.
Приходит уведомление в телеграмм (В кухне зафиксирована протечка воды). В sls шлюзе начинает издаваться громкие звуки. После устранения протечки открываются краны, + уведомление в телеграмм, шлюз перестает трубить.
3) Использование времени Восхода/Заката (онлайн), в зависимости от времени года и числа. 
Если солнце зашло, изменить яркость на 60
Если солнце встало, изменить яркость на 120
Если солнце встало 3 часа назад, изменить яркость на 180
4) Несколько действий при срабатывании датчика.
Закрылась дверь в туалете -> Включилась вытяжка (реле Zigbee), Изменилась яркость на 200. 
Открылась дверь в туалете -> Выключилась вытяжка (реле Zigbee), Изменилась яркость на 10.
5) Таймеры: Событие -> действие –> включился таймер, как таймер закончится, произойдет другое действие.
При срабатывании датчика движения изменить яркость на 200, через 40 мин изменить яркость на 10., если движение повторится, процесс повторится и таймер сбросится на 40 мин.
Телеграмм:
создана кнопка, например включения света. И выкючения света.
кнопка вывода информации со всех датчиков. Например вольтаж.
Функция – если свойство ниже порога, вывести свойство в телеграмм в читаемом виде.
Есть кнопка «Выключить автоматическое управление», и включить автомат. Управление. – Меняет свойство созданого обьекта «auto» на 0 или 1. При выполнении сценария проходит функция if … && … &&. 
Если выполняется условие (АВТО = 1 && Солнце встало = 1) при срабатывании датчика движения выполнить действие. Если AUTO=0, проверка обрывается, действие не выполняется.

