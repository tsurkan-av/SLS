# Контроль температуры удаленных объектов

Все знакомы с проблемами ЖКХ в потрепанных жилых фондах. Мой дом не исключение. Зимой холодно и при отключениях воды завоздушиваются стояки ГВС. И в том и другом случае достаточно сложно доказывать УК, что температуры не соответствуют нормам. Особенно отопления.

Для контроля решено было использовать [4-х канальное реле Modkam](https://modkam.ru/2019/11/19/rele-zigbee-v-podrozetnik/), которое существует в формате 4-х канального датчика температуры. Устройство на базе универсально прошивки для zigbee устройств [PTVO](https://ptvo.info/zigbee-configurable-firmware-features/). Купил я его [здесь](https://t.me/zigberu). Устройство доставило мне массу проблем: то его не спаришь, то оно отваливается. Рекомендации вендора не помогали и я забросил проект в долгий ящик.

После публикации статьи о [навыке Алисы для умного дома Яндекс](https://github.com/tsurkan-av/SLS/blob/main/AliceSkills/funtik/Readme.md), который я разработал еще в начале 2023 года, один из пользователей отметил, что пользуется навыком [WQTT](https://www.wqtt.ru/). Я попробовал навык в работе. И, там же, в документации, наткнулся на проект [ESP Easy](https://letscontrolit.com/wiki/index.php/ESPEasy) - это универсальная прошивка, но для устройств на базе ESP.

В итоге, на базе ESP32-WROOM получил решение, которое умеет:

- собирать данные с 6-ти датчиков типа DS18B20, подключенных по витой паре на шлейфе до 25 метров
- отправлять данные на [SLS](https://github.com/slsys/Gateway) и [mqtt](https://www.wqtt.ru/) и далее в Алису для сбора исторических данных

Let's begin

## Железо

В проекте были использованы:

- [ESP-32S на отладочной плате DEVKIT v1](https://megabonus.com/y/8EwzA)
- датчики [DS18B20](https://megabonus.com/y/19urt)

Датчики подключены к ESP по [классической схеме](https://www.letscontrolit.com/wiki/index.php?title=Dallas_DS18b20) с подтягивающим резистором 4k7 2-ух парным кабелем типа витая пара. По одной паре питание, по другой - сигнал. Питание всей схемы от источника +5v - обычный USB-зарядник. Сигнал на GPIO-17.

Датчики крепил к стоякам через термоинтерфейс с очисткой от краски.

## Настройка ESP 

По [прошивке ESP](https://espeasy.readthedocs.io/en/latest/Reference/Flashing.html) достаточно много материала в сети, в том числе и в рунете. Поэтому останавливаться на этом не будем.

### Настройка датчиков

Датчики подключаются через плагин [Environment - 1-Wire Temperature](https://espeasy.readthedocs.io/en/latest/Plugin/P004.html). Данный плагин поддерживает до 4-х датчиков и позволяет передавать данные на контроллер одним пакетом или показание каждого датчика отдельными пакетами.